#beginCommonToolV3("tool.common.globalSubscriptions.header" "" "" false true false)

<script type="text/javascript">
<!--
	function showDiv(id)
	{
		document.getElementById(id).style.display = 'block';
	}
	
	function hideDiv(id)
	{
		document.getElementById(id).style.display = 'none';
	}
	
	function loadExistingSubscription(id)
	{
		//alert("Init " + id);
		$("#dialogDivBody").load("Subscriptions!getSubscriptionForm.action?subscriptionId=" + id);
		$("#newSubscriptionForm").css("display", "block"); 
	}
	
	var i=1;
	function addFilterRow()
	{
		var addition = ' <div id="filterRow_' + i + '" class="formRow" style="min-height: 50px; border: 0px solid red; border-bottom: 1px solid #bbb;">';
		addition += ' <label id="filterRow_' + i + 'Label" for="filterType_' + i + '">$ui.getString("tool.common.subscriptionFilterType.label")</label>';
		addition += ' <select id="filterType_' + i + '" name="filterType_' + i + '" onchange="updateConditionInput(' + i + ');">';
		addition += '	<option value="">$ui.getString("tool.common.chooseFilterType.label")</option>';
		addition += '	<option value="0">Content types</option>';
		addition += '	<option value="1">Categories</option>';
		addition += ' </select>';

		addition += ' <label id="filterCondition_' + i + 'Label" for="filterCondition_' + i + '">$ui.getString("tool.common.subscriptionFilterCondition.label")</label>';
		addition += ' <select id="filterCondition_' + i + '" name="filterCondition_' + i + '" multiple="multiple" size="3" style="width: 150px;">';
		addition += '	<option value="-1">$ui.getString("tool.common.chooseFilterType.label")</option>';
		addition += ' </select>';

		addition += ' &nbsp; <a id="removeFilterRowLink' + i + '" href="javascript:removeFilterRow(' + i + ');">Remove filter</a>';
		
		addition += ' <p id="andParagraph_' + i + '" style="padding-left: 300px; display: none; float: left; text-align: center;"><!--<label for="isAndCondition_' + i + '">isAndCondition</label>-->';
		addition += ' <select id="isAndCondition_' + i + '" name="isAndCondition_' + i + '">';
		addition += '	<option value="true">AND</option>';
		addition += '	<option value="false">OR</option>';
		addition += ' </select></p>';
		addition += ' </div>';
		
		addition += ' <div id="break_' + i + '" style="clear:both"></div>';
	
		$("#break_" + (i-1)).after(addition);
		
		$("#andParagraph_" + (i-1)).css("display", "block"); 
		
		i++;
	}


	function removeFilterRow(index)
	{
		$("#filterRow_" + index).remove(); 
		$("#break_" + index).remove(); 
		
		var currentIndex = index;
		while(currentIndex < i)
		{
			//alert("Changing " + (currentIndex + 1) + " to " + currentIndex);
			$("#filterRow_" + (currentIndex + 1) + "Label").attr("id", "filterRow_" + currentIndex + "Label");
			$("#filterRow_" + (currentIndex + 1)).attr("id", "filterRow_" + currentIndex).attr("name", "filterRow_" + currentIndex);
			$("#filterType_" + (currentIndex + 1) + "Label").attr("id", "filterType_" + currentIndex + "Label");
			$("#filterType_" + (currentIndex + 1)).attr("id", "filterType_" + currentIndex).attr("name", "filterType_" + currentIndex);
			$("#filterCondition_" + (currentIndex + 1)).attr("id", "filterCondition_" + currentIndex).attr("name", "filterCondition_" + currentIndex);
			$("#andParagraph_" + (currentIndex + 1)).attr("id", "andParagraph_" + currentIndex).attr("name", "andParagraph_" + currentIndex);
			$("#removeFilterRowLink" + (currentIndex + 1)).attr("id", "removeFilterRowLink" + currentIndex).attr("href", "javascript:removeFilterRow(" + currentIndex + ");");
			$("#break_" + (currentIndex + 1)).attr("id", "break_" + currentIndex);
			currentIndex++;
		}
		i--;
	}
	
	var contentTypes = '<option value="">Choose filter type</option>';
	#foreach($contentTypeDefintionVO in $contentTypeDefintionVOList)
		contentTypes += '<option value="$contentTypeDefintionVO.id">$contentTypeDefintionVO.name</option>';
	#end

	var categories = '<option value="">Choose filter type</option>';
	#foreach($categoryVO in $categoryVOList)
		categories += '<option value="$categoryVO.id">$categoryVO.name</option>';
	#end
	
	function updateConditionInput(filterIndex)
	{
		//alert("filterIndex:" + filterIndex);
		var value = $("#filterType_" + filterIndex).val();
		//alert("value:" + value + " - " + filterIndex);
		if(value == -1)
		{
			$("#filterCondition_" + filterIndex).html("<option value='-1'>Choose filter type</option>");
		}
		if(value == 0)
		{
			$("#filterCondition_" + filterIndex).html(contentTypes);
		}
		else if(value == 1)
		{
			$("#filterCondition_" + filterIndex).html(categories);
		}
	}
	
	$(document).ready(function(){
    	$("#filterType_0 option:first").attr( "selected", "selected" );
	});

	function submitForm()
	{
		document.editForm.submit();
	}

//-->
</script>

#menuToolbar("" $buttons $rightButtons)

<div style="clear: both;" onfocus="this.blur();"></div>

<h3 style="text-indent: 16px;">
	$ui.getString("tool.common.globalSubscriptions.title")
	#if($errorMessage != "")<span style="color:red">$errorMessage</span>#end
</h3>

<div onfocus="this.blur();">

	<div class="inlineTabDiv" onfocus="this.blur();">
	#foreach($subscriptionVO in $subscriptionVOList)
	
		<a href="javascript:loadExistingSubscription($subscriptionVO.id);">$subscriptionVO.name</a> - 
		<a href="Subscriptions!deleteGlobalSubscription.action?subscriptionId=$subscriptionVO.id">Delete</a><br/>
	
	#end
		
	#if($subscriptionVOList.size() == 0)
		$ui.getString("tool.common.noSubscriptionsFount.label")
	#end
	</div>
</div>
	
<div id="newSubscriptionForm" style="display: none; position: absolute; top: 100px; left: 50px; width: 700px; border: 1px solid black;">
	<div id="dialogHandle" class="dialogDivHandle"><div id="dialogDivLeftHandle" class="dialogDivLeftHandle">$ui.getString("tool.common.createChangeSubscriptions.label")</div><div id="dialogDivRightHandle" class="dialogDivRightHandle"><a href="javascript:hideDiv('newSubscriptionForm');">$ui.getString("tool.common.closeWindowButton.label")</a></div></div>
	<div id="dialogDivBody" class="dialogDivBody">
		<form action="Subscriptions!globalSubscriptions.action" name="inputForm" method="post">
			<fieldset style="width: 90%; border: 0px solid red; margin: 0px; padding-left: 10px;">
	
				<h3>$ui.getString("tool.common.subscriptionBasics.label")</h3>
				<p style="clear: both;">
				<label for="name">$ui.getString("tool.common.subscriptionName.label")</label>
				<input type="text" name="name"/>
				</p>
				
				<p style="clear: both;">
				<label for="interceptionPointId">$ui.getString("tool.common.subscriptionType.label")</label>
				<select name="interceptionPointId">
					#foreach($interceptionPointVO in $interceptionPointVOList)
					<option value="$interceptionPointVO.id">$ui.getString($interceptionPointVO.name)</option>
					#end
				</select>
				</p>
				
				<div style="clear: both;"></div>
				
				<h4 style="border-bottom: 1px solid #bbb;">$ui.getString("tool.common.subscriptionsFilters.label")</h4>
				
				<div id="filterRow_0" class="formRow" style="min-height: 50px; border: 0px solid red; border-bottom: 1px solid #bbb;">
					<label for="filterType_0">$ui.getString("tool.common.subscriptionFilterType.label")</label>
					<select id="filterType_0" name="filterType_0" onchange="updateConditionInput(0);">
						<option value="-1" selected="selected">$ui.getString("tool.common.chooseFilterType.label")</option>
						<option value="0">Content types</option>
						<option value="1">Categories</option>
					</select>
			
					<label for="filterCondition_0">$ui.getString("tool.common.subscriptionFilterCondition.label")</label>
					<select id="filterCondition_0" name="filterCondition_0" multiple="multiple" size="3" style="width: 150px;">
						<option value="">$ui.getString("tool.common.chooseFilterType.label")</option>
					</select>
					
					&nbsp; <a href="javascript:removeFilterRow(0);">Remove filter</a>
					
					<p id="andParagraph_0" style="padding-left: 300px; display: none; float: left; text-align: center;">
						<!-- <label for="isAndCondition_0">tool.common.subscriptionFilterIsAndCondition.label</label> -->
						<select id="isAndCondition_0" name="isAndCondition_0">';
							<option value="true">AND</option>';
							<option value="false">OR</option>';
						</select>
					</p>
				</div>
									
				<div id="break_0" style="clear:both"></div>
				
				<br/>
				<a href="javascript:addFilterRow();">Add filter</a>
				<br/>
				<br/>
				
				<input type="submit" value="Save"/>
	
			</fieldset>
		</form>
	</div>
</div>

#footerToolbar($footerButtons)

#endCommonToolV3()
